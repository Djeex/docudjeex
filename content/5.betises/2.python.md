---
navigation: true
title: Scripts python
main:
  fluid: false
---
:ellipsis{left=0px width=40rem top=10rem blur=140px}
# Scripts python

Mes cochonneries en python

## ü§ñ Nvidia Stock Bot
---

Depuis d√©j√† 4 ans, la p√©nurie de materiel electronique fait rage. Et les cartes graphiques ne sont pas √©pargn√©es. En 2020, j'ai du attendre 2 mois pour obtenir mon exemplaire de RTX 3080, et pour cela j'ai du m'inscrire sur [JV Hardware](https://discord.gg/gxffg3GA96) o√π une poign√©e de geek avait mis en place un bot qui envoyait un ping lorsqu'elles √©taient disponibles.

4 ans apr√®s et 5000 abonn√©s plus tard, vient la sortie des RTX 5000. Et l√† aucun bot dispo sur le march√© ne semble fonctionner correctement. Je ne parle m√™me pas d'un certain "influenceur" qui se permet de faire payer l'acc√®s √† son bot qui ne fonctionne meme pas. Il copie √† la main les alertes provenant d'autres serveurs, comme le notre qui ont r√©solu le probl√®me.

Quoiqu'il en soit, d√©sireux d'obtenir une RTX 5090 pour ma machine d√©di√©e √† l'IA, je me suis dit qu'il √©tait peut etre le temps de plonger dans le monde de python et de ChatGPT pour m'√©pauler. A l'aide d'un autre membre du serveur, KevOut, qui a principalement guid√© sur le principe de d√©part et les sources des diff√©rentes API, j'ai r√©ussi √† obtenir un bot propre, fonctionnel, qui envoie diff√©rents types d'alertes via Discord. Avec un simple conteneur docker √† d√©ployer.

Apr√®s moult d√©convenues, je suis pass√© de ceci :

![Nvidia Stock Bot Old](https://git.djeex.fr/Djeex/nvidia-stock-bot/raw/commit/88c09ff4cffd96cbf0852ec785f9fbf2130c23b2/assets/img/nvbot.png)

√† cela :

![Nvidia Stock bot](https://git.djeex.fr/Djeex/nvidia-stock-bot/raw/branch/main/assets/img/nvbot_schematics.png)

Plus d'infos directement sur le repo :

 
  ::card
  #title
    üêã __Nvidia Stock Bot__
  #description
  [Robot d'alerte de stock de GPU Nvidia](https://git.djeex.fr/Djeex/nvidia-stock-bot)
  ::

## ü§ñ Adguard CIDRE Sync
---

Adguard Home est une solution merveilleuse pour filter ses requ√™tes DNS et ainsi se d√©barasser de la publicit√© ou des DNS des fournisseurs d'acc√®s, ou encore r√©√©crire des requetes.

Quand c'est en local, c'est tr√®s chouette. Mais quand on veut que tout ses appareils en profitent m√™me √† l'exterieur, on est oblig√© de l'exposer sur le net. Et n'importe qui peut s'en servir et saturer le petit remote √† 1‚Ç¨ qu'on a pris pour l'heberger.

Adguard permet d'avoir des listes de clients autoris√©s ou bloqu√©s. Probl√®me, pour autoriser un client il faut son IP, et dans le cas d'un t√©l√©phone sur le r√©seau mobile, beh elle change r√©guli√®rement. L'id√©e est donc plutot de bloquer des listes g√©n√©rales plutot que d'autoriser des IP qui de toute fa√ßon changent r√©guli√®rement.

CIDRE est un outil qui permet de synchroniser des listes de plages IP g√©olocalis√©es mises √† jour r√©guli√®rement avec un pare feu. Plutot que de faire tourner CIDRE sur le remote complet avec des r√®gles de pare feu complexes, je me suis dit qu'il fallait simplement s'arranger pour ajouter les plages IP √† jour que CIDRE propose au systeme de block list d'adguard, selon les pays que l'on souhaite bloquer.

C'est ainsi qu'est n√© Adguard CIDRE Sync, un conteneur qui synchronise r√©guli√®rement la block list d'Adguard avec les plages IP recens√©es par CIDRE √† la fr√©quence que vous voulez.

L'id√©e etant de :
- Backup le fichier de conf d'Adguard au premier lancement (le fichier jamais touch√© par le robot est ainsi conserv√© au cas o√π)
- T√©l√©charger la liste des pays selectionn√©s via une variable d'environnement
- Permettre d'ajouter soi-meme des IP "√† la main" dans un fichier
- Concat√©ner le tout, backup le fichier de conf (derni√®re update), et injecter la liste dans la bonne section du fichier de conf d'Adguard
- Recharger Adguard en relan√ßant le container (acc√®s au socket via docker socket proxy pour limiter les permissions)

Tout ceci de mani√®re compl√®tement autonome, avec une fr√©quence choisie en variable d'environnement dans la conf du compose.

Plus d'infos directement sur le repo :

 
  ::card
  #title
    üêã __Adguard CIDRE Sync__
  #description
  [Robot de synchronisation de la blocklist d'Adguard](https://git.djeex.fr/Djeex/adguard-cidre)
  ::
