---
navigation: true
title: NAT & DHCP
main:
  fluid: false
---
:ellipsis{left=0px width=40rem top=10rem blur=140px}
# Routeur et NAT
::alert{type="info"}
üéØ  __Objectifs :__
- Comprendre le principe de la redirection de port
- Savoir configurer le NAT de son routeur
- Savoir √©mettre des baux DHCP (IP fixes)
::

![picture](/img/global/nat.svg)

## Qu'est-ce qu'un "port" ?
---
Les ports sont diff√©rents canaux par lesquels votre routeur envoie et re√ßoit des donn√©es, ce qui permet d'utiliser plusieurs services en meme temps. Lorsqu'il re√ßoit une donn√©e via un port, otre routeur transmet ensuite les donn√©es √† la machine qui :
- soit a √©mis la requ√™te de d√©part
- soit est configur√©e pour recevoir les donn√©es re√ßues par un port sp√©cifique du routeur

Votre routeur dispose de plus de 65 000 ports √† utiliser.

Certains programmes et applications sont con√ßus pour utiliser des ports sp√©cifiques. Par exemple, lorsque votre r√©seau envoie des donn√©es √† partir d'une page HTML, le routeur les recevra via le port num√©ro 80 (non s√©curis√©) ou 443 (s√©curis√© via SSL). 

Le routeur sert donc de plateforme d'aiguillage des donn√©es entre internet et votre machine.

## La redirection de port
---
Rediriger un `port`, c'est √©mettre une r√®gle qui sp√©cifie que telle `source` peut envoyer des donn√©es √† tel `port` de votre routeur, qui redirigera les donn√©es sur tel `port` de telle `machine`. Les `sources` et la `machine de destination` sont identifi√©es par leur `adresse IP`.

| Variable                 | Description                                              | exemple                 |
|--------------------------|----------------------------------------------------------|-------------------------|
|         `machine source` |                   IP de la machine source (sur internet) | `All`<br>`123.45.67.89` |
|            `port source` |                            Port d'arriv√©e sur le routeur |                   `443` |
|    `port de destination` |             Port d'arriv√©e sur la machine de destination |                  `3000` |
| `machine de destination` | IP de la machine de destination (sur votre r√©seau local) |          `192.168.1.50` |

Selon ce tableau, si on enl√®ve le `All` et que l'on garde l'ip `123.45.67.89` en provenance d'internet, tout le traffic envoy√© depuis cette IP sur le port `443` du routeur sera redirig√© vers le port `3000` de l'IP locale `192.168.1.50`.

Si on enl√®ve l'IP de l'exemple et qu'on laisse le `All`, tout le traffic d'internet envoy√© au port `443` du routeur sera redirig√© vers le port `3000` de l'IP locale `192.168.1.50`.

C'est utile si par exemple vous avez un serveur qui a un service qui n√©cessite d'etre accessible par internet. Par exemple, un site web. Le web utilise le port `80` (non s√©curis√©) et le port 443 (s√©curis√© par certificat SSL) pour communiquer. Ainsi, si je veux que mon site internet soit accessible, je vais faire en sorte que lorsqu'on tape le nom de domaine de mon site, le routeur redirige bien vers mon serveur local (avec l'exemple de l'IP locale du tableau). Par exemple, imaginons que mon service est sur le port `3000` de mon routeur (accessible en local via `http://192.168.1.50:3000`), je vais donc rediriger comme dans l'exemple toutes les sources (All) qui passent par le port `443` du routeur vers le port `3000` de mon serveur local.

::alert{type="warning"}
:::list{type="warning"}
- __Attention :__ Si vous avez plusieurs services √† rendre accessible, avec par exemple `sousdomaine1.mondomaine.fr` et `sousdomaine2.mondomaine.fr`, votre routeur ne peut pas rediriger vers plusieurs port selon la requ√™te. Vous devrez utiliser un [Reverse Proxy](../../serveex/coeur/swag) qui selon la requete redirigera vers le bon service de votre serveur.
:::
::

## Le DHCP
---
A chaque fois que vous connectez un appareil sur votre r√©seau local, votre routeur lui attribue une adresse IP via les r√®gles DHCP. Celle-ci est al√©atoire selon des r√®gles pr√©d√©finies. A chaque red√©marrage de l'appareil, l'IP peut changer. C'est embetant si vous exposez un service et que vous avez une redirection de port dans votre routeur car si l'IP change, la redirection enverra les donn√©es dans le vide. Le serveur DHCP de votre box permet d'attribuer une IP fixe √† un appareil.

Chaque appareil a une adresse physique dite "adressse MAC". Pour fixer l'IP, vous devez connaitre l'adresse physique de votre appareil (visible dans votre routeur si votre machine est connect√©e au r√©seau), et lui attribuer une adresse IP fixe, ce qu'on appel un "bail DHCP fixe".

Ainsi, l'IP de votre machine ne changera jamais et la redirection de port sera toujours effective.

| Variable      | Description                    | Exemple             |
|---------------|--------------------------------|---------------------|
| `IP`          | IP locale fixe √† attribuer     | `192.168.1.50`      |
| `Adresse Mac` | Adresse physique de la machine | `5E:FF:56:A2:AF:15` |

Pour plus d'information sur ces sujets, consultez la documentation de votre routeur.