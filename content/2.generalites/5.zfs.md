---
navigation: true
title: ZFS
main:
  fluid: false
---
:ellipsis{left=0px width=40rem top=10rem blur=140px}
# ZFS

::alert{type="info"}
ğŸ¯ __Objectifs :__
- Comprendre ce qu'est ZFS et son utilitÃ©
::

ZFS est populaire dans le monde des serveurs, des NAS (comme FreeNAS / TrueNAS), de la virtualisation, et mÃªme chez les particuliers qui veulent un stockage rÃ©silient. C'est est un _systÃ¨me de fichier_ (Ã  l'instar de NTFS pour windows, EXT4, FAT32 etc...) mais Ã©galement un __gestionnaire de volume__ (comme LVM par exemple). Pour le dire (trÃ¨s) rapidement, un gestionnaire de volume arrange l'espace sur des espaces physiques comme un ou plusieurs disques durs, et un gestionnaire de fichier arrange la maniere dont sont organisÃ©s les blocs de donnÃ©es dans ces volumes pour Ã©crire, lire et supprimer les donnÃ©es.


ZFS dÃ©passe largement les limites des autres systÃ¨mes de fichiers, que cela soit en terme de performance ou de fonctionnalitÃ©.
Ce qui nous intÃ©resse le plus :
- ses fonctionnalitÃ©s de __gestion des instantanÃ©s__ (snaphsot), permettant de rapidement revenir en arriÃ¨re en cas de problÃ¨me
- sa gestion des grappes de disques et [__ses Ã©quivalent au RAID__](/generalites/raid) (Z-Mirror, RAIDZ1, RAIDZ2, RAIDZ3)
- sa __reconstruction automatique des donnÃ©es corrumpues__ (via le scrubbing)
- ses performance avec son cache RAM (ZFS ARC)
- ses notifications en cas d'erreur

## Structure

![](/img/global/zfs.svg)

ZFS dispose d'une structure particuliÃ¨re :

- __vdev__ (virtual device) : une grappe de disques (physiques ou virtuel)
- __zpool__ : un ensemble de disques physiques ou virtuels en volume simple, Z-mirror ou RAIDZ. Un _zpool_ peut englober plusieurs _vdev_ mais pas l'inverse.
- __dataset__ : un systÃ¨me de de donnÃ©e dans un _zpool_. Chaque dataset peut avoir ses propres options (compression, quotas, permissions, etc.).

Il existe plusieurs types de dataset :
- __file system__ : un systÃ¨me de fichier, ZFS par dÃ©faut, montÃ© comme un volume sans quota de stockage.
- __zvol__ : un "disque virtuel" avec un quota d'espace, que vous pouvez formater/partitionner comme vous le souhaitez. Il sera utilisable comme un disque physique.
- __snapshot__ : un Ã©tat figÃ© dâ€™un autre dataset Ã  un instant donnÃ©. Ils peuvent etre crÃ©Ã©s manuellement ou via des outils de sauvegarde. Ils peuvent etre montÃ©s pour parcourir les donnÃ©es dans leur Ã©tat au moment du snapshot.

## Pourquoi ZFS vs les autres ?

### IntÃ©gritÃ© des donnÃ©es

ZFS vÃ©rifie automatiquement que les donnÃ©es stockÃ©es ne sont pas corrompues. Chaque bloc de donnÃ©es est accompagnÃ© dâ€™une empreinte (checksum) qui permet Ã  ZFS de dÃ©tecter toute altÃ©ration, mÃªme minime. Et sâ€™il y a un problÃ¨me, il peut souvent le rÃ©parer automatiquement, si une copie saine existe ailleurs dans le systÃ¨me.

### RAID intÃ©grÃ©

ZFS propose son propre systÃ¨me de gestion de volumes (vdev). Vous pouvez crÃ©er un pool de stockage (zpool) en combinant plusieurs disques, un peu comme avec le [RAID](/generalites/raid) classique, mais de faÃ§on plus souple. Par exemple :
- __Z-mirror__ => equivalent du RAID 1
- __RAIDZ1__ => Ã©quivalent du RAID 5 (tolÃ©rance Ã  1 panne disque)
- __RAIDZ2__ => Ã©quivalent du RAID 6 (tolÃ©rance Ã  2 pannes disque)
- __RAIDZ3__ => (tolÃ©rance Ã  3 pannes disque)

ZFS gÃ¨re cela directement, pas besoin de logiciel RAID externe.

::alert{type="info"}
:::list{type="info"}
- Consultez [l'article sur le RAID](/generalites/raid) pour en savoir plus sur la solution qui vous convient.
:::
::

### Snapshots et clones

ZFS permet de crÃ©er des snapshots, câ€™est-Ã -dire des captures instantanÃ©es de lâ€™Ã©tat dâ€™un systÃ¨me de fichiers Ã  un moment donnÃ©. Ces snapshots prennent trÃ¨s peu dâ€™espace et peuvent Ãªtre crÃ©Ã©s automatiquement et frÃ©quemment. Vous pouvez aussi faire des clones : des copies modifiables dâ€™un snapshot.

### Compression et dÃ©duplication

ZFS peut compresser les donnÃ©es Ã  la volÃ©e (transparente pour lâ€™utilisateur), ce qui permet dâ€™Ã©conomiser de lâ€™espace disque. Il propose aussi la dÃ©duplication (Ã©liminer les doublons), mais cette fonctionnalitÃ© consomme beaucoup de mÃ©moire et nâ€™est pas recommandÃ©e pour tous les usages.

VoilÃ , Ã  prÃ©sent vous savez pourquoi ZFS est Ze systeme de fichier Ã  dÃ©ployer sur votre NAS.