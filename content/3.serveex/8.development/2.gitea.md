---
navigation: true
title: Gitea
main:
  fluid: false
---
:ellipsis{left=0px width=40rem top=10rem blur=140px}
# Gitea

::alert{type="info"}
üéØ __Objectifs :__
- Installer Gitea
- Exposer Gitea avec Swag
::

[Gitea](https://https://about.gitea.com/) est une plateforme DevOps, permettant de g√©rer des d√©pots, √† la mani√®re de GitHub mais chez vous en selfhost.

![gitea](https://about.gitea.com/img/home-screenshot.png)

## Installation
---
Structure des dossiers

```console
root
‚îî‚îÄ‚îÄ docker
    ‚îî‚îÄ‚îÄ gitea
        ‚îî‚îÄ‚îÄ data
```

Ouvrez Dockge, cliquez sur `compose`, appelez la stack `gitea` puis copiez collez ceci :

```yaml
---
networks:
  gitea:
    external: false
services:
  server:
    image: gitea/gitea:1.22.0
    container_name: gitea
    environment:
      - USER_UID=${UID}
      - USER_GID=${GID}
      - TZ=Europe/Paris
    restart: unless-stopped
    networks:
      - gitea
    volumes:
      - ./data:/data
    ports:
      - 3333:3000
      - 222:22
```
Et renseignez le `.env` avec les infos que vous avez trouv√©es, par exemple :

```properties
UID=1000
GID=1000
```

D√©ployez le conteneur et rendez-vous sur `http://ipduserveur:3333`. Et voil√†, votre instance Gitea est disponible !

::alert{type="danger"}
:::list{type="danger"}
- __En cas d'√©chec :__ v√©rifiez les r√®gles de votre pare-feu.
:::
::

## Exposer Gitea avec Swag
---
Tout l'int√©r√™t d'une telle solution, c'est de pouvoir y acc√©der √† distance et sur tout vos appareils. Pour cela, nous allons exposer Gitea via Swag.

::alert{type="info"}
:::list{type="info"}
- __Au pr√©alable :__ nous partons du principe que vous avez cr√©√© dans votre [zone DNS](/generalites/dns) un sous domaine du type `gitea.mondomaine.fr` avec pour `CNAME` `mondomaine.fr` et, [√† moins que vous utilisiez Cloudflare Zero Trust](/serveex/securite/cloudflare), que que vous avez d√©j√† redirig√© le port `443` de votre box vers le `443` de votre serveur dans [les r√®gles NAT](/generalites/nat).
:::
::

Dans Dockge, rendez-vous dans la stack de SWAG et √©ditez le compose en ajoutant le r√©seau de gitea :

```yaml
services:
  swag:
     container_name: # ...
      # ... 
     networks:           # Relie le conteneur au r√©seau custom 
      # ...           
      - gitea            # Nom du r√©seau d√©clar√© dans la stack
    
networks:                # D√©finit le r√©seau custom
  # ...
  gitea:                 # Nom du r√©seau d√©clar√© dans la stack
    name: gitea_default  # Nom v√©ritable du r√©seau externe
    external: true       # Pr√©cise que c'est un r√©seau √† rechercher en externe
```

::alert{type="info"}
:::list{type="info"}
- Ici nous partons du principe que le nom du r√©seau de gitea est `gitea_default`. Vous pouvez v√©rifier que la connexion est op√©rationnelle en visitant le dashboard de SWAG en tapant http://ipduserveur:81.
:::
::

Relancez la stack en cliquant sur "d√©ployer" et patientez le temps que SWAG soit compl√®tement op√©rationnel.

Dans les dossiers de Swag, cr√©ez le fichier `gitea.subdomain.conf`.

::alert{type="success"}
‚ú® __Astuce :__ vous pouvez utiliser [File Browser](/serveex/files/file-browser) pour naviguer dans vos fichier et √©diter vos documents au lieu d'utiliser les commandes du terminal.
::

```shell
sudo vi /docker/swag/config/nginx/proxy-confs/gitea.subdomain.conf
```
Entrez en modification avec la touche `i` et collez la configuration ci-dessous :

```nginx
## Version 2023/12/19

server {
    listen 443 ssl;
    listen [::]:443 ssl;

    server_name gitea.*;

    include /config/nginx/ssl.conf;

    client_max_body_size 0;

    # enable for ldap auth (requires ldap-location.conf in the location block)
    #include /config/nginx/ldap-server.conf;

    # enable for Authelia (requires authelia-location.conf in the location block)
    #include /config/nginx/authelia-server.conf;

    # enable for Authentik (requires authentik-location.conf in the location block)
    #include /config/nginx/authentik-server.conf;

    location / {
        # enable the next two lines for http auth
        #auth_basic "Restricted";
        #auth_basic_user_file /config/nginx/.htpasswd;

        # enable for ldap auth (requires ldap-server.conf in the server block)
        #include /config/nginx/ldap-location.conf;

        # enable for Authelia (requires authelia-server.conf in the server block)
        #include /config/nginx/authelia-location.conf;

        # enable for Authentik (requires authentik-server.conf in the server block)
	      #include /config/nginx/authentik-location.conf;

        include /config/nginx/proxy.conf;
        include /config/nginx/resolver.conf;
        set $upstream_app gitea;
        set $upstream_port 3000;
        set $upstream_proto http;
        proxy_pass $upstream_proto://$upstream_app:$upstream_port;

    }

    location ~ (/gitea)?/info/lfs {
        include /config/nginx/proxy.conf;
        include /config/nginx/resolver.conf;
        set $upstream_app gitea;
        set $upstream_port 3000;
        set $upstream_proto http;
        proxy_pass $upstream_proto://$upstream_app:$upstream_port;

    }
}
```

Appuyez sur `Echap` puis sauvegardez et quittez en tapant `:x` puis en appuyant sur `Entr√©e`.

Ouvrez le fichier `app.ini` dans les fichiers du conteneur

```shell
sudo vi /docker/gitea/data/gitea/conf/app.ini
```

Entrez en modification avec la touche `i` et et modifiez la section serveur avec les infos de votre domaine

```properties
[server]
DOMAIN = gitea.mondomaine.fr
SSH_DOMAIN = gitea.mondomaine.fr
ROOT_URL = https://gitea.mondomaine.fr/
```
Appuyez sur `Echap` puis sauvegardez et quittez en tapant `:x` puis en appuyant sur `Entr√©e`.

Relancez le conteneur.

Et voil√†, vous avez expos√© Gitea !

::alert{type="success"}
‚ú® __Astuce :__ Vous pouvez prot√©ger cette app avec Authentik de fa√ßon native en [suivant ces instructions](https://docs.goauthentik.io/integrations/services/gitea/).
::
