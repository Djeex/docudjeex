---
navigation: true
title: Vaultwarden
main:
  fluid: false
---
:ellipsis{left=0px width=40rem top=10rem blur=140px}
# Vaultwarden

::alert{type="info"}
üéØ __Objectifs :__ Installer [Vaultwarden](https://github.com/dani-garcia/vaultwarden) pour g√©rer vos mot de passe sur tout vos appareils (remplace la gestion de mot de passe Google ou Apple).
::

![Vaultwarden](/img/serveex/vaultwarden.png)

[Vaultwarden](https://github.com/dani-garcia/vaultwarden) est une solution de gestion de vos mot de passe (g√©n√©ration, saisie semi-automatique...) que vous pouvez installer directement sur votre serveur. Cette solution remplace les gestionnaires comme Google, Apple ou Keepass. Cette solution permet de synchroniser tout vos mots de passe sur vos diff√©rentes machines, avec un chiffrement de bout en bout.

Vaultwarden est un fork de la solution [Bitwarden](https://bitwarden.com/fr-fr/help/).

## Installation
---
Structure des dossiers

```console
root
‚îî‚îÄ‚îÄ docker
    ‚îî‚îÄ‚îÄ vaultwarden
        ‚îú‚îÄ‚îÄ data
        ‚îú‚îÄ‚îÄ compose.yaml
        ‚îî‚îÄ‚îÄ .env
```

Ouvrez Dockge, cliquez sur `compose`, appelez la stack `vaultwarden` puis copiez collez ceci :

```yaml
---
services:
  vaultwarden:
    container_name: vaultwarden
    image: vaultwarden/server:latest
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      - ./data/:/data/
    ports:
      - 3050:80
    environment:
      - DOMAIN=${URL}
      - LOGIN_RATELIMIT_MAX_BURST=10
      - LOGIN_RATELIMIT_SECONDS=60
      - ADMIN_RATELIMIT_MAX_BURST=10
      - ADMIN_RATELIMIT_SECONDS=60
      - ADMIN_TOKEN=${TOKEN}
      - SENDS_ALLOWED=true
      - EMERGENCY_ACCESS_ALLOWED=true
      - WEB_VAULT_ENABLED=true
      - SIGNUPS_ALLOWED=false
      - SIGNUPS_VERIFY=true
      - SIGNUPS_VERIFY_RESEND_TIME=3600
      - SIGNUPS_VERIFY_RESEND_LIMIT=5

```

::alert{type="success"}
‚ú® __Astuce :__ Ajoutez le label de watchtower dans chaque conteneur afin d'automatiser les mises √† jour

    ```yaml
    services:
      vauktwarden:
        #...
        labels:
          - com.centurylinklabs.watchtower.enable=true
::

Nous allons maintenant g√©n√©rer un hash de mot de passe, qu'il faudra renseigner dans la variable `TOKEN` du `.env`

```shell
echo -n 'votremotdepasse' | argon2 "$(openssl rand -base64 32)" -e -id -k 65540 -t 3 -p 4
```

Copiez le r√©sultat pr√©cieusement et gardez en t√™te le mot de passe que vous avez choisi.

Dans le `.env`, renseignez les variables suivantes :

```properties
URL=
TOKEN=
```

| Variable                | Valeur                                                  | Exemple                    |
|-------------------------|---------------------------------------------------------|----------------------------|
| `URL`{lang=properties}   | L'url de votre serveur vaultwarden                      | `https://vault.domaine.fr` |
| `TOKEN`{lang=properties} | Le token que vous avez pr√©c√©demment copi√© pr√©cieusement | `'$argon2id$v=19$m=65540,t=3,p=4$bXBGME` |

Puis d√©ployez le conteneur.

Depuis quelques temps, Vaultwarden ne permet pas d'etre acc√©der sans certificat SSL, ce qui empeche d'y acc√©der via son IP local. Nous y acc√®derons donc apr√®s l'avoir expos√© avec SWAG, qui ajoute lui m√™me un certificat SSL.


::alert{type="danger"}
:::list{type="danger"}
- __En cas d'√©chec :__ v√©rifiez les r√®gles de votre pare-feu.
:::
::

## Exposer Vaultwarden avec SWAG
---
Tout l'int√©r√™t d'une telle solution, c'est de pouvoir y acc√©der √† distance et sur tout vos appareils. Pour cela, nous allons exposer Vaultwarden via [SWAG](/serveex/coeur/swag).

::alert{type="info"}
‚ú® __Au pr√©alable :__ nous partons du principe que vous avez cr√©√© dans votre [zone DNS](/generalites/dns) un sous domaine du type `vault.mondomaine.fr` avec pour `CNAME` `mondomaine.fr` et, [√† moins que vous utilisiez Cloudflare Zero Trust](/serveex/securite/cloudflare), que que vous avez d√©j√† redirig√© le port `443` de votre box vers le `443` de votre serveur dans [les r√®gles NAT](/generalites/nat).
::

Dans Dockge, rendez-vous dans la stack de SWAG et √©ditez le compose en ajoutant le r√©seau de vaultwarden :

```yaml
services:
  swag:
     container_name: # ...
      # ... 
     networks:             # Relie le conteneur au r√©seau custom 
      # ...           
      - vaultwarden            # Nom du r√©seau d√©clar√© dans la stack
    
networks:                  # D√©finit le r√©seau custom
  # ...
  vaultwarden:                 # Nom du r√©seau d√©clar√© dans la stack
    name: vaultwarden_default  # Nom v√©ritable du r√©seau externe
    external: true         # Pr√©cise que c'est un r√©seau √† rechercher en externe
```

::alert{type="info"}
:::list{type="info"}
- Ici nous partons du principe que le nom du r√©seau de vaultwarden est `vaultwarden_default`. Vous pouvez v√©rifier que la connexion est op√©rationnelle en visitant le dashboard de SWAG en tapant http://ipduserveur:81.
:::
::

Relancez la stack en cliquant sur "d√©ployer" et patientez le temps que SWAG soit compl√®tement op√©rationnel.

Dans les dossiers de Swag, cr√©ez le fichier `vault.subdomain.conf`.

::alert{type="success"}
‚ú® __Astuce :__ vous pouvez utiliser [File Browser](/serveex/files/file-browser) pour naviguer dans vos fichier et √©diter vos documents au lieu d'utiliser les commandes du terminal.
::

```shell
sudo vi /docker/swag/config/nginx/proxy-confs/vault.subdomain.conf
```
Entrez en modification avec la touche `i` et collez la configuration ci-dessous :

```nginx
server {
    listen 443 ssl;
    listen [::]:443 ssl;

    server_name vault.*;

    include /config/nginx/ssl.conf;

    client_max_body_size 128M;

    # enable for ldap auth (requires ldap-location.conf in the location block)
    #include /config/nginx/ldap-server.conf;

    # enable for Authelia (requires authelia-location.conf in the location block)
    #include /config/nginx/authelia-server.conf;

    # enable for Authentik (requires authentik-location.conf in the location block)
    #include /config/nginx/authentik-server.conf;

    location / {
        # enable the next two lines for http auth
        #auth_basic "Restricted";
        #auth_basic_user_file /config/nginx/.htpasswd;

        # enable for ldap auth (requires ldap-server.conf in the server block)
        #include /config/nginx/ldap-location.conf;

        # enable for Authelia (requires authelia-server.conf in the server block)
        #include /config/nginx/authelia-location.conf;

        # enable for Authentik (requires authentik-server.conf in the server block)
        #include /config/nginx/authentik-location.conf;

        include /config/nginx/proxy.conf;
        include /config/nginx/resolver.conf;
        set $upstream_app vaultwarden;
        set $upstream_port 80;
        set $upstream_proto http;
        proxy_pass $upstream_proto://$upstream_app:$upstream_port;

    }

    location ~ ^(/vaultwarden)?/admin {
        # enable the next two lines for http auth
        #auth_basic "Restricted";
        #auth_basic_user_file /config/nginx/.htpasswd;

        # enable for ldap auth (requires ldap-server.conf in the server block)
        #include /config/nginx/ldap-location.conf;

        # enable for Authelia (requires authelia-server.conf in the server block)
        #include /config/nginx/authelia-location.conf;

        # enable for Authentik (requires authentik-server.conf in the server block)
        #include /config/nginx/authentik-location.conf;

        include /config/nginx/proxy.conf;
        include /config/nginx/resolver.conf;
        set $upstream_app vaultwarden;
        set $upstream_port 80;
        set $upstream_proto http;
        proxy_pass $upstream_proto://$upstream_app:$upstream_port;

    }

    location ~ (/vaultwarden)?/api {
        include /config/nginx/proxy.conf;
        include /config/nginx/resolver.conf;
        set $upstream_app vaultwarden;
        set $upstream_port 80;
        set $upstream_proto http;
        proxy_pass $upstream_proto://$upstream_app:$upstream_port;

    }

    location ~ (/vaultwarden)?/notifications/hub {
        include /config/nginx/proxy.conf;
        include /config/nginx/resolver.conf;
        set $upstream_app vaultwarden;
        set $upstream_port 80;
        set $upstream_proto http;
        proxy_pass $upstream_proto://$upstream_app:$upstream_port;

    }
}
```

Appuyez sur `Echap` puis sauvegardez et quittez en tapant `:x` puis en appuyant sur `Entr√©e`.

Et voil√†, vous avez expos√© Vaultwarden ! Acc√©dez au panneau d'administration via `https://vault.mondomaine.fr/admin` et collez le mot de passe que vous avez choisi pour g√©n√©rer l'`ADMIN_TOKEN`. Plus d'info sur les fonctionnalit√©s de [Bitwarden](https://bitwarden.com/help/).

N'oubliez pas d'installer les extensions Bitwarden (elles sont compatibles avec Vaultwarden) pour [Chrome](https://chromewebstore.google.com/detail/gestionnaire-de-mots-de-p/nngceckbapebfimnlniiiahkandclblb) ou pour [Firefox](https://addons.mozilla.org/fr/firefox/addon/bitwarden-password-manager/) ainsi que les applications [iOS](https://apps.apple.com/fr/app/bitwarden/id1137397744) et [Android](https://play.google.com/store/apps/details?id=com.x8bit.bitwarden&hl=fr) afin de synchroniser vos mot de passe.

::alert{type="success"}
‚ú® __Astuce :__ vous pouvez prot√©ger cette app avec Authentik en ouvrant `tools.subodmain.conf` et en retirant les `#` devant `include /config/nginx/authentik-server.conf;`{lang=nginx} et `include /config/nginx/authentik-location.conf;`{lang=nginx}. N'oubliez pas de [cr√©er une application et un fournisseur dans Authentik](/serveex/securite/authentik#prot√©ger-une-app-par-reverse-proxy).
::