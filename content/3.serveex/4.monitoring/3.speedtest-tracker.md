---
navigation: true
title: Speedtest Tracker
main:
  fluid: false
---
:ellipsis{left=0px width=40rem top=10rem blur=140px}
# Speedtest Tracker

::alert{type="info"}
üéØ __Objectifs :__
- Installer Speedtest Tracker
- Exposer Speedtest Tracker avec Swag
::

[Speedtest Tracker](https://docs.speedtest-tracker.dev/) est un conteneur permettant de programmer des speedtest r√©gulier afin d'historiser l'√©tat de la connexion internet de votre serveur.

![speedtest-tracker](/img/serveex/speedtest-tracker.avif)

## Installation
---
::alert{type="info"}
:::list{type="info"}
- Nous utiliserons l'image docker maintenue par [LinuxServer.io](https://docs.linuxserver.io/images/docker-speedtest-tracker/)
:::
::

Structure des fichiers

```sh
root
‚îî‚îÄ‚îÄ docker
    ‚îî‚îÄ‚îÄ speedtest-tracker
        ‚îî‚îÄ‚îÄ data
            ‚îî‚îÄ‚îÄ config
```

Dans un terminal, g√©n√©rez une cl√© avec la commande suivante :

```sh
echo -n 'base64:'; openssl rand -base64 32;
```

Notez la cl√©.

Ouvrez Dockge, cliquez sur `compose`, appelez la stack `speedtest-tracker` puis copiez collez ceci :

```yaml
---
services:
    speedtest-tracker:
        image: lscr.io/linuxserver/speedtest-tracker:latest
        restart: unless-stopped
        container_name: speedtest-tracker
        ports:
            - ${PORT}$:80
        environment:
            - PUID=${PUID}
            - PGID=${GUID}
            - TZ=Europe/Paris
            - APP_KEY=${API_KEY}
            - DB_CONNECTION=sqlite
            - SPEEDTEST_SCHEDULE=${SCHEDULE}
        volumes:
            - /docker/speedtest-tracker/data/config:/config
```

Trouvez votre `PUID` et votre `GUID` en tapant la commande suivante :

```sh
id nomdutilisateur
```

Dans `.env` renseignez la variable `API_KEY` avec la cl√© que vous avez g√©n√©r√©e et un planning de test au format cron, ainsi que vos `PUID` et `GUID`, par exemple :

```properties
SCHEDULE=15 */6 * * * # toutes les 6h
API_KEY=base64:zihejehkj8_nzhY/OjeieR= # votre cl√©
PUID=1000
GUID=1000
PORT=3225 # port d'acc√®s √† la webui
```

::alert{type="success"}
‚ú® __Astuce :__ vous pouvez configurer d'autres variables d'environnements en consultant la [documentation officielle](https://docs.speedtest-tracker.dev/getting-started/environment-variables).
::

D√©ployez le conteneur et rendez-vous sur http://ipduserveur:3225. Connectez vous avec le compte `admin@exemple.com` et le mot de passe `password`. N'oubliez pas de changer votre id et votre mot de apsse une fois connect√© !


## Exposer Speedtest Tracker
---
::alert{type="info"}
üìã __Pr√©requis :__ <br/></br>
Nous partons du principe que vous avez cr√©√© dans votre [zone DNS](/generalites/reseau/dns) un sous domaine du type `speedtest.mondomaine.fr` avec pour `CNAME` `mondomaine.fr` et [√† moins que vous utilisiez Cloudflare Zero Trust](/serveex/securite/cloudflare), que vous avez d√©j√† redirig√© le port `443` de votre box vers le `443` de votre serveur dans [les r√®gles NAT](/generalites/reseau/nat).
::

Il s'agit maintenant d'exposer Speedtest Tracker sur internet, afin de pouvoir y acc√©der sans que vous soyez chez vous. Pour cela, nous partons du principe que vous avez configur√© un sous domaine `speedtest.mondomaine.fr` dans votre zone DNS dont le `CNAME` pointe sur `mondomaine.fr`.

::alert{type="warning"}
:::list{type="warning"}
- Speedtest Tracker n'utilise pas d'authentification multifacteur. Exposer Speedtest Tracker sur internet pourrait compromettre les machines auxquelles il est reli√©. Ne le faite que si vous utilisez un systeme d'authentification multifacteur comme [Authentik](/serveex/securite/authentik/). Sinon, n'exposez pas avec SWAG et utilisez plut√¥t un VPN comme [Wireguard](/serveex/securite/wireguard).
:::
::

Ouvrez le fichier speedtest.subdomain.conf :

```sh
sudo vi /docker/swag/config/nginx/proxy-confs/speedtest.subdomain.conf
```

Param√©trez le comme tel :

```nginx
## Version 2023/12/19

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    
    # indique que le sous-domaine doit √™tre dirig√©
    server_name speedtest.*;  

    include /config/nginx/ssl.conf;

    client_max_body_size 0;

    #if ($lan-ip = yes) { set $geo-whitelist yes; }
    #if ($geo-whitelist = no) { return 404; }
    # indique que les pays dans la blacklist sont intedits
    if ($geo-blacklist = no) { return 404; } 

    # enable for ldap auth (requires ldap-location.conf in the location block)
    #include /config/nginx/ldap-server.conf;

    # enable for Authelia (requires authelia-location.conf in the location block)
    #include /config/nginx/authelia-server.conf;

    # enable for Authentik (requires authentik-location.conf in the location block)
    #include /config/nginx/authentik-server.conf;

    location / {
        # enable the next two lines for http auth
        #auth_basic "Restricted";
        #auth_basic_user_file /config/nginx/.htpasswd;

        # enable for ldap auth (requires ldap-server.conf in the server block)
        #include /config/nginx/ldap-location.conf;

        # enable for Authelia (requires authelia-server.conf in the server block)
        #include /config/nginx/authelia-location.conf;

        # enable for Authentik (requires authentik-server.conf in the server block)
        #include /config/nginx/authentik-location.conf;

        include /config/nginx/proxy.conf;
        include /config/nginx/resolver.conf;
        
        set $upstream_app speedtest-tracker; # Nom du conteneur
        set $upstream_port 3225; # Port interne conteneur
        set $upstream_proto http;
        proxy_pass $upstream_proto://$upstream_app:$upstream_port;

    }
}
```

Sauvegardez et quittez. La configuration va se mettre √† jour en quelques secondes. 

::alert{type="info"}
:::list{type="info"}
- Par d√©faut, swag ne connait pas le nom "speedtest-tracker". Pour qu'il puisse y acc√©der, vous devez rajouter le r√©seau de Speedtest Tracker dans le `compose.yml` de SWAG.
:::
::

Rendez-vous dans dockge, et √©ditez le compose de SWAG en ajoutant le r√©seau de Speedtest Tracker :

```yaml
services:
  swag:
     container_name: # ...
      # ... 
     networks:                       # Relie le conteneur au r√©seau custom 
      # ...           
      - speedtest-tracker            # Nom du r√©seau d√©clar√© dans la stack
    
networks:                            # D√©finit le r√©seau custom
  # ...
  speedtest-tracker:                 # Nom du r√©seau d√©clar√© dans la stack
    name: speedtest-tracker_default  # Nom v√©ritable du r√©seau externe
    external: true                   # Pr√©cise que c'est un r√©seau √† rechercher en externe
```

Relancez la stack en cliquant sur "d√©ployer" et patientez le temps que SWAG soit compl√®tement op√©rationnel.

::alert{type="info"}
:::list{type="info"}
- Ici nous partons du principe que le nom du r√©seau de Speedtest Tracker est `speedtest-tracker_default`. Vous pouvez v√©rifier que la connexion est op√©rationnelle en visitant le dashboard de SWAG en tapant `http://ipduserveur:81`.
:::
::

Patientez puis tapez `https://speedtest.mondomaine.fr` dans votre navigateur, vous devriez √™tre redirig√© vers speedtest-tracker. Vous pouvez v√©rifier le statut du service via le dashboard (depuis votre r√©seau local, http://ipdevotreserveur:81).

::alert{type="success"}
‚ú® Vous pouvez prot√©ger cette app avec Authentik en ouvrant `speedtest.subodmain.conf` et en retirant les `#` devant `include /config/nginx/authentik-server.conf;`{lang=nginx} et `include /config/nginx/authentik-location.conf;`{lang=nginx}. N'oubliez pas de [cr√©er une application et un fournisseur dans Authentik](/serveex/securite/authentik#prot√©ger-une-app-par-reverse-proxy).
::
