---
navigation: true
title: Uptime-Kuma
main:
  fluid: false
---
:ellipsis{left=0px width=40rem top=10rem blur=140px}
# Uptime-Kuma

::alert{type="info"}
üéØ __Objectifs :__
- Installer et d√©ployer Uptime-Kuma
- Exposer Uptime Kuma
- (Optionnel) Prot√©ger Uptime-Kuma avec Authentik
::

[Uptime-Kuma ](https://github.com/louislam/uptime-kuma)est un conteneur d√©di√© au monitoring de services. Le principe est d'envoyer des requ√™tes r√©guli√®res √† vos services afin de d√©terminer s'ils sont en lignes ou non, et de vous alerter le cas √©ch√©ant. Uptime-Kuma est d√©velopp√© par le meme d√©veloppeur que Dockge. 

![picture](https://user-images.githubusercontent.com/1336778/212262296-e6205815-ad62-488c-83ec-a5b0d0689f7c.jpg)

## Installation
---
Structure des dossiers

```console
root
‚îî‚îÄ‚îÄ docker
    ‚îî‚îÄ‚îÄ uptime-kuma
        ‚îú‚îÄ‚îÄ date
        ‚îî‚îÄ‚îÄ compose.yaml
```

Ouvrez Dockge, cliquez sur `compose`, appelez la stack `uptime-kuma` puis copiez collez ceci :

```yaml
---
services:
  uptime-kuma:
    image: louislam/uptime-kuma:1
    container_name: uptime-kuma
    volumes:
      - /docker/uptime-kuma/uptime-kuma-data:/app/data
    ports:
      - 3200:3001 # <Host Port>:<Container Port>
    restart: always
```
::alert{type="success"}
‚ú® __Astuce :__ ajoutez le label de watchtower dans chaque conteneur afin d'automatiser les mises √† jour

    ```yaml
    services:
      uptime-kuma:
        #...
        labels:
          - com.centurylinklabs.watchtower.enable=true
::

Vous n'avez plus qu'√† acc√©der √† l'outil via `http://ipdevotreserveur:3200`.

::alert{type="danger"}
:::list{type="danger"}
- __En cas d'√©chec :__ v√©rifiez les r√®gles de votre pare-feu.
:::
::

## Exposer avec Swag
---
::alert{type="info"}
üìã __Au pr√©alable :__ 
<br/><br/>
Nous partons du principe que vous avez le sous-domaine `stats.mondomaine.fr` avec un `CNAME` qui pointe vers `mondomaine.fr` dans votre [zone DNS](/generalites/dns). Et que bien s√ªr, [√† moins que vous utilisiez Cloudflare Zero Trust](/serveex/securite/cloudflare), le port `443` de votre box pointe bien sur le port `443` de votre serveur via [les r√®gles NAT](/generalites/nat).
::

::alert{type="warning"}
:::list{type="warning"}
- Uptime-Kuma n'utilise pas d'authentification multifacteur. Exposer Uptime-Kuma sur internet pourrait compromettre les machines auxquelles il est reli√©. Ne le faite que si vous utilisez un systeme d'authentification multifacteur comme [Authentik](/serveex/securite/authentik/). Sinon, n'exposez pas avec SWAG et utilisez plut√¥t un VPN comme [Wireguard](/serveex/securite/wireguard).
:::
::

Dans les dossiers de Swag, cr√©ez le fichier `stats.subdomain.conf`.

::alert{type="success"}
‚ú® __Astuce pour les allergiques au terminal :__
vous pouvez utiliser [File Browser](/serveex/files/file-browser) pour naviguer dans vos fichier et √©diter vos documents au lieu d'utiliser les commandes du terminal.
::

```shell
sudo vi /docker/swag/config/nginx/proxy-confs/stats.subdomain.conf
```
Entrez en modification avec la touche `i` et collez la configuration ci-dessous :

```nginx
## Version 2023/12/19

server {
    listen 443 ssl;
    listen [::]:443 ssl;

    server_name stats.*;

    include /config/nginx/ssl.conf;

    client_max_body_size 0;

    #if ($lan-ip = yes) { set $geo-whitelist yes; }
    #if ($geo-whitelist = no) { return 404; }
    if ($geo-blacklist = no) { return 404; }

    # enable for ldap auth (requires ldap-location.conf in the location block)
    #include /config/nginx/ldap-server.conf;

    # enable for Authelia (requires authelia-location.conf in the location block)
    #include /config/nginx/authelia-server.conf;

    # enable for Authentik (requires authentik-location.conf in the location block)
    #include /config/nginx/authentik-server.conf;

    location / {
        # enable the next two lines for http auth
        #auth_basic "Restricted";
        #auth_basic_user_file /config/nginx/.htpasswd;

        # enable for ldap auth (requires ldap-server.conf in the server block)
        #include /config/nginx/ldap-location.conf;

        # enable for Authelia (requires authelia-server.conf in the server block)
        #include /config/nginx/authelia-location.conf;

        # enable for Authentik (requires authentik-server.conf in the server block)
        #include /config/nginx/authentik-location.conf;

        include /config/nginx/proxy.conf;
        include /config/nginx/resolver.conf;
        set $upstream_app uptime-kuma;
        set $upstream_port 3001;
        set $upstream_proto http;
        proxy_pass $upstream_proto://$upstream_app:$upstream_port;

    }
}
```
Appuyez sur `Echap` puis sauvegardez et quittez en tapant `:x` puis en appuyant sur `Entr√©e`.

Rendez-vous dans dockge, et √©ditez le compose de SWAG en ajoutant le r√©seau d'Uptime-Kuma :

```yaml
services:
  swag:
     container_name: # ...
      # ... 
     networks:                 # Relie le conteneur au r√©seau custom 
      # ...           
      - uptime-kuma            # Nom du r√©seau d√©clar√© dans la stack
    
networks:                      # D√©finit le r√©seau custom
  # ...
  uptime-kuma:                 # Nom du r√©seau d√©clar√© dans la stack
    name: uptime-kuma_default  # Nom v√©ritable du r√©seau externe
    external: true             # Pr√©cise que c'est un r√©seau √† rechercher en externe
```

Relancez la stack et patientez le temps que SWAG soit compl√®tement op√©rationnel.

::alert{type="info"}
:::list{type="info"}
- Ici nous partons du principe que le nom du r√©seau de Uptime-Kuma est `uptime-kuma_default`. Vous pouvez v√©rifier que la connexion est op√©rationnelle en visitant le dashboard de SWAG en tapant `http://ipduserveur:81`.
:::
::

Et voil√†, vous avez expos√© Uptime-Kuma, vous pouvez y acc√©der en tapant `https://stats.mondomaine.fr`

::alert{type="success"}
‚ú® __Astuce :__ 
<br/><br>
Vous pouvez prot√©ger cette app avec Authentik en ouvrant `stats.subodmain.conf` et en retirant les `#` devant `include /config/nginx/authentik-server.conf;`{lang=nginx} et `include /config/nginx/authentik-location.conf;`{lang=nginx}. N'oubliez pas de [cr√©er une application et un fournisseur dans Authentik](/serveex/securite/authentik#prot√©ger-une-app-par-reverse-proxy). Si vous souhaitez que la page publique de stats soit joignable par tout le monde sans authentification:

- Editez le fournisseur d'Uptime-Kuma
- Dans *param√®tres avanc√©s du protocole > chemins authentifi√©s*, saisissez :

    ```properties
    ^/$
    ^/status
    ^/assets/
    ^/assets
    ^/icon.svg
    ^/api/.*
    ^/upload/.*
    ^/metrics    
::

D√©ployez √† nouveau la stack.

Uptime-Kuma sera ainsi joignable directement depuis internet en tapant `https://stats.mondomaine.fr`.


::alert{type="success"}
‚ú® __Astuce :__ Si vous utilisez Authentik et que vous ne craignez pas d'exposer votre panneau admin √† votre r√©seau local, vous pouvez d√©sactiver l'authentification d'Uptime-Kuma via les param√®tres, afin de ne garder que celle d'Authentik.
::