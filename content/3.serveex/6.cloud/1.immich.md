---
navigation: true
title: Immich
main:
  fluid: false
---
:ellipsis{left=0px width=40rem top=10rem blur=140px}
# Immich

::alert{type="info"}
üéØ __Objectifs :__ installer [Immich](https://immich.app/docs/overview/introduction) pour g√©rer vos photos sur tout vos appareils.
::

[Immich](https://immich.app/docs/overview/introduction) est une solution de gestion de photos et de vid√©os que vous pouvez installer directement sur votre serveur. Cette solution remplace les clouds type Google Photo ou iCloud. Elle dispose de nombreuse fonctionnalit√©s comme la reconnaissance de visage ou la g√©olocalisation.

![Picture](/img/serveex/immich.png)

## Installation
---
Structure des dossiers

```sh
root
‚îî‚îÄ‚îÄ docker
    ‚îî‚îÄ‚îÄ immich
        ‚îú‚îÄ‚îÄ library
        ‚îú‚îÄ‚îÄ compose.yaml
        ‚îî‚îÄ‚îÄ .env
```


Ouvrez Dockge, cliquez sur `compose`, appelez la stack `immich` puis copiez collez le contenu du dernier `docker-compose.yml` [publi√© ici](https://github.com/immich-app/immich/blob/main/docker/docker-compose.yml). 

::alert{type="warning"}
:::list{type="warning"}
- __Attention__ : n'ajoutez pas le label de Watchtower √† la stack d'Immich. Immich √©tant une solution en perpetuelle √©volution, des mises √† jour automatiques risqueraient de casser votre installation.
:::
::

Configurer le `.env` en copiant collant le contenu de la derni√®re version [publi√©e ici](https://github.com/immich-app/immich/blob/main/docker/example.env) et suivez les commentaires indiqu√©s dans le fichier.


::alert{type="info"}
:::list{type="info"}
- Si vous avez un NAS ou un disque r√©seau partag√© via [samba](/generalites/reseau/samba/) pour stocker vos donn√©es, remplacez la valeur de `UPLOAD_LOCATION`{lang=properties} par le chemin d'acc√®s de votre dossier partag√©.
:::
::

::alert{type="success"}
‚ú® __Astuce :__ si votre CPU/iGPU/GPU le supporte, Immich permet d'utiliser l'acc√©l√©ration mat√©rielle pour lire les vid√©os ou pour la reconnaissance d'images. Ces fonctionnalit√©s peuvent tripler les performances d'Immich. Plus d'infos sur le [Transcoding](https://immich.app/docs/features/hardware-transcoding/) et sur le [Machine learning](https://immich.app/docs/features/ml-hardware-acceleration).
::

D√©ployez le conteneur.

Et voil√†, vous pouvez vous connecter et suivre les instructions sur `http://ipduserveur:2283`

## Exposer Immich avec Swag
---
Tout l'int√©r√™t d'une telle solution, c'est de pouvoir y acc√©der √† distance et sur tout vos appareils. Pour cela, nous allons exposer Immich via Swag.

::alert{type="info"}
üìã __Au pr√©alable :__ 
<br/><br/>
Nous partons du principe que vous avez le sous-domaine `immich.mondomaine.fr` avec un `CNAME` qui pointe vers `mondomaine.fr` dans votre [zone DNS](/generalites/reseau/dns). Et que bien s√ªr, [√† moins que vous utilisiez Cloudflare Zero Trust](/serveex/securite/cloudflare), le port `443` de votre box pointe bien sur le port `443` de votre serveur via [les r√®gles NAT](/generalites/reseau/nat).
::

Dans Dockge, rendez-vous dans la stack de SWAG et √©ditez le compose en ajoutant le r√©seau de immich :

```yaml
services:
  swag:
     container_name: # ...
      # ... 
     networks:            # Relie le conteneur au r√©seau custom 
      # ...           
      - immich            # Nom du r√©seau d√©clar√© dans la stack
    
networks:                 # D√©finit le r√©seau custom
  # ...
  immich:                 # Nom du r√©seau d√©clar√© dans la stack
    name: immich_default  # Nom v√©ritable du r√©seau externe
    external: true        # Pr√©cise que c'est un r√©seau √† rechercher en externe
```

::alert{type="info"}
:::list{type="info"}
- Ici nous partons du principe que le nom du r√©seau de immich est `immich_default`. Vous pouvez v√©rifier que la connexion est op√©rationnelle en visitant le dashboard de SWAG en tapant http://ipduserveur:81.
:::
::

Relancez la stack en cliquant sur "d√©ployer" et patientez le temps que SWAG soit compl√®tement op√©rationnel.


Dans les dossiers de Swag, cr√©ez le fichier `immich.subdomain.conf`.

::alert{type="success"}
:::list{type="success"}
- __Astuce :__ vous pouvez utiliser [File Browser](/serveex/files/file-browser) pour naviguer dans vos fichier et √©diter vos documents au lieu d'utiliser les commandes du terminal.
:::
::

```sh
sudo vi /docker/swag/config/nginx/proxy-confs/immich.subdomain.conf
```
Entrez en modification avec la touche `i` et collez la configuration ci-dessous :

```nginx
## Version 2023/12/19

server {
    listen 443 ssl;
    listen [::]:443 ssl;

    server_name immich.*;

    include /config/nginx/ssl.conf;

    client_max_body_size 0;

    #if ($lan-ip = yes) { set $geo-whitelist yes; }
    #if ($geo-whitelist = no) { return 404; }
    if ($geo-blacklist = no) { return 404; }

    # enable for ldap auth (requires ldap-location.conf in the location block)
    #include /config/nginx/ldap-server.conf;

    # enable for Authelia (requires authelia-location.conf in the location block)
    #include /config/nginx/authelia-server.conf;

    # enable for Authentik (requires authentik-location.conf in the location block)
    #include /config/nginx/authentik-server.conf;

    location / {
        # enable the next two lines for http auth
        #auth_basic "Restricted";
        #auth_basic_user_file /config/nginx/.htpasswd;

        # enable for ldap auth (requires ldap-server.conf in the server block)
        #include /config/nginx/ldap-location.conf;

        # enable for Authelia (requires authelia-server.conf in the server block)
        #include /config/nginx/authelia-location.conf;

        # enable for Authentik (requires authentik-server.conf in the server block)
        #include /config/nginx/authentik-location.conf;

        include /config/nginx/proxy.conf;
        include /config/nginx/resolver.conf;
        set $upstream_app immich_server;
        set $upstream_port 3001;
        set $upstream_proto http;
        proxy_pass $upstream_proto://$upstream_app:$upstream_port;

    }

    location ~ (/immich)?/api {
        include /config/nginx/proxy.conf;
        include /config/nginx/resolver.conf;
        set $upstream_app immich_server;
        set $upstream_port 3001;
        set $upstream_proto http;
        proxy_pass $upstream_proto://$upstream_app:$upstream_port;

    }
}
```

Appuyez sur `Echap` puis sauvegardez et quittez en tapant `:x` puis en appuyant sur `Entr√©e`.

Et voil√†, vous avez expos√© Immich ! N'oubliez pas d'installer les applications [iOS](https://apps.apple.com/us/app/immich/id1613945652)/[Android](https://play.google.com/store/apps/details?id=app.alextran.immich) afin de synchroniser vos appareils.

::alert{type="success"}
‚ú® __Astuce :__ Vous pouvez prot√©ger cette app avec Authentik de fa√ßon native en [suivant ces instructions](https://docs.goauthentik.io/integrations/services/immich/).
::
